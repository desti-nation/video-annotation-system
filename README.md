# 工作状态视频数据标注系统

这是一个本地运行的Web应用程序，用于对工作状态相关的视频数据进行逐帧或区间标注，并生成结构化的标注数据。

## 功能特点

- 自动生成用户ID（中文姓名自动转拼音，保留数字字母）
- 视频文件夹路径配置与记忆
- 历史记录功能，支持快速选择曾用用户名和路径
- 加载和浏览视频文件列表，视觉区分已标注视频
- 视频播放控制（播放、暂停、逐帧前进/后退、拖动进度条、调整播放速度）
- 区间标注（开始时间、结束时间）与帧标注（特定时间点）
- 支持多用户标注，区分自己与他人的标注
- 标注列表管理（查看、编辑、删除标注）
- 标注数据JSON格式保存，结构简洁
- 导出标注视频片段和关键帧图片

## 最新更新

### 历史记录功能
- 自动记录曾经使用过的用户姓名和视频路径
- 提供下拉菜单快速选择历史记录
- 最多保存10条历史记录，优先显示最新记录
- 无需重复输入常用配置，提高工作效率

### 视频列表显示优化
- 采用色彩和视觉效果区分自己和他人的标注状态
- 已标注视频增加边框和背景色区分效果
- 添加徽章动画效果，使标注状态更加醒目
- 适用不同颜色区分不同状态：自己标注（绿色）、他人标注（蓝色）、混合标注（紫色）

### 标注信息紧凑化
- 简洁显示文件名和标注信息
- 在文件名下方以"我:X 他人:Y"格式显示标注数量
- 优化空间利用，保持整洁的视觉体验

### 用户ID自动生成
- 移除用户ID手动输入，仅需输入姓名
- 自动将中文姓名转换为拼音作为用户ID
- 智能保留用户名中的数字和英文字符（如"王欣2"生成"wangxin2"）
- 多种拼音转换方案，包括外部库和内置字典

### JSON结构简化
- 采用更精简的数据结构，只保留核心annotations字段
- 每条标注包含用户ID和用户名信息，方便识别
- 简化结构便于直接编辑，保持向前兼容性

## 系统要求

- Python 3.9+
- Flask 2.2.3+
- MoviePy 1.0.3+
- OpenCV-Python 4.7.0+

## 安装与配置

1. 克隆或下载本项目到本地

2. 安装依赖包：
   ```
   pip install -r requirements.txt
   ```

3. 运行应用：
   ```
   python run.py
   ```
   应用将在本地启动，并自动在默认浏览器中打开 http://127.0.0.1:5000

## 使用方法

1. **初始配置**：
   - 输入您的姓名（系统自动生成拼音ID）或从下拉列表选择曾用姓名
   - 输入包含视频文件的文件夹绝对路径或从下拉列表选择曾用路径
   - 点击"加载/设置"按钮

2. **视频选择与播放**：
   - 在左侧视频列表中选择要标注的视频（颜色区分已标注状态）
   - 使用视频播放器控制视频播放

3. **添加标注**：
   - 选择标注类型（区间标注或帧标注）
   - 对于区间标注，设置开始和结束时间
   - 对于帧标注，标记当前帧
   - 输入标注标签，点击"保存标注"按钮

4. **管理标注**：
   - 在右侧标注列表中查看所有标注
   - 可切换查看"仅我的标注"或"所有标注"
   - 点击标注项可以跳转到相应时间点
   - 使用编辑和删除按钮管理自己的标注

5. **导出可视化**：
   - 点击"导出可视化"按钮
   - 输入导出目标目录路径
   - 系统将视频片段和关键帧导出到指定目录

## 数据存储

- 标注数据以JSON格式保存在视频文件旁边（同名+.json后缀）
- 采用简洁的JSON结构，包含视频路径、视频ID、修改时间和标注数组
- 每条标注包含类型、时间点、帧号、标签、用户ID等信息
- 导出的视频片段和帧图像保存在用户指定的目录中
- 用户姓名和视频路径历史记录保存在系统根目录下的user_history.json文件中

## 界面效果

- **初始配置**：提供历史记录下拉选择，方便快速填写
- **视频列表**：颜色区分标注状态，动画效果提升用户体验
- **标注信息**：紧凑展示，清晰直观
- **标注操作**：简单便捷，支持两种标注模式
- **多用户支持**：清晰区分自己和他人的标注

## 注意事项

- 请确保应用有读取视频文件夹和写入标注文件的权限
- 支持的视频格式：mp4, avi, mov, mkv, wmv
- 时间格式：HH:MM:SS.mmm（小时:分钟:秒.毫秒）
- 用户配置信息存储在浏览器本地存储中，切换浏览器需重新配置
- 历史记录存储在服务器端，不同浏览器可共享使用

## 开发者信息

本系统最近更新于2025年。

## 许可证

本项目采用 MIT 许可证。